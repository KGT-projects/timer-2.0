<!DOCTYPE html>
<html lang="en">
<head><meta charset="utf-8">
<title>Timer Control</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
  body { display:flex; flex-direction:column;
    justify-content:center; align-items:center;
    height:100vh; margin:0; font-family:sans-serif;
    background:#f8f8f8;
  }
  button { padding:1rem 2rem; font-size:1.2rem; margin:0.5rem; cursor:pointer; }
  #status { margin-top:1rem; color:green; }
</style>
</head>
<body>
  <button id="sub">Subtract 4 Hours</button>
  <button id="rst">Reset to 32 Hours</button>
  <div id="status"></div>
<script>
const TOKEN = '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';
const REPO = 'KGT-projects/timer-2.0';
const PATH = 'time.json';
const init = 115200, delta = 14400;
let sha = null;

async function getTime(){
  const r = await fetch(`https://api.github.com/repos/${REPO}/contents/${PATH}`);
  const j = await r.json();
  sha = j.sha;
  return JSON.parse(atob(j.content)).timeLeft;
}
async function setTime(v){
  const content = btoa(JSON.stringify({ timeLeft: v },null,2));
  await fetch(`https://api.github.com/repos/${REPO}/contents/${PATH}`, {
    method:'PUT',
    headers:{ Authorization:'Bearer '+TOKEN,'Content-Type':'application/json' },
    body: JSON.stringify({ message:'Control update', content, sha })
  }).then(r=>r.json()).then(j=>{ sha=j.content.sha });
}
async function sub4(){
  let t= await getTime();
  t = Math.max(0, t-delta);
  await setTime(t);
  status.innerText='-4 hours done';
}
async function reset(){
  await getTime();
  await setTime(init);
  status.innerText='Reset done';
}

sub.addEventListener('click', sub4);
rst.addEventListener('click', reset);
</script>
</body>
</html>
