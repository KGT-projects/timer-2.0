<!DOCTYPE html>
<html>
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Control</title></head>
<body>
  <button onclick="subtract(4 * 3600)">âˆ’4 hours</button>
  <button onclick="reset()">Reset (32 h)</button>

  <script>
    const GITHUB_TOKEN = 'YOUR_TOKEN';
    const BASE = 'https://api.github.com/repos/KGT-projects/timer-2.0/contents/time.json';

    async function fetchState() {
      const res = await fetch(BASE, { headers: { Authorization: `Bearer ${GITHUB_TOKEN}` } });
      const json = await res.json();
      return { sha: json.sha, value: JSON.parse(atob(json.content)).timeLeft };
    }

    async function save(newSeconds) {
      const { sha } = await fetchState();
      await fetch(BASE, {
        method: 'PUT',
        headers: {
          Authorization: `Bearer ${GITHUB_TOKEN}`,
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          message: 'Update timer',
          content: btoa(JSON.stringify({ timeLeft: newSeconds }, null, 2)),
          sha
        })
      });
      alert('Updated to ' + newSeconds + ' seconds');
    }

    async function subtract(sec) {
      const { value } = await fetchState();
      await save(Math.max(0, value - sec));
    }

    async function reset() {
      await save(32 * 3600);
    }
  </script>
</body>
</html>
