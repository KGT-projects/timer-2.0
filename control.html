<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Control</title>
  <style>
    body {
      font-family:sans-serif;
      padding:2rem;
      background:#f5f5f5;
      text-align:center;
    }
    
    button {
      font-size:1.5rem;
      margin:1rem;
      padding:1rem 2rem;
    }
    #status { margin-top:1rem; }
  </style>
</head>
<body>
  <h1>Timer Control</h1>
  <button onclick="adjust(-4)">–4 uur</button>
  <button onclick="adjust(32)">Reset naar 32 uur</button>
  <div id="status"></div>

  <script>
    const REPO = 'KGT-projects/timer-2.0';
    const PATH = 'time.json';
    const TOKEN = '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';
    let sha = null;

    function formatHours(h) {
      return h * 3600;
    }

    async function getData() {
      const res = await fetch(`https://api.github.com/repos/${REPO}/contents/${PATH}`);
      const j = await res.json();
      sha = j.sha;
      return JSON.parse(atob(j.content)).timeLeft;
    }

    async function setTime(sec) {
      const body = btoa(JSON.stringify({ timeLeft: sec }, null,2));
      const res = await fetch(`https://api.github.com/repos/${REPO}/contents/${PATH}`, {
        method: 'PUT',
        headers: {
          Authorization: `token ${TOKEN}`,
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ message:'Control update', content: body, sha })
      });
      const j = await res.json();
      sha = j.content.sha;
      document.getElementById('status').textContent = '✅ Timer is aangepast';
    }

    async function adjust(hours) {
      const current = await getData();
      if (hours===32) {
        await setTime(formatHours(32));
      } else {
        await setTime(Math.max(0, current - formatHours(4)));
      }
    }
    async function testTokenWithCurlStyle() {
  const token = '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';
  const fileUrl = 'https://api.github.com/repos/KGT-projects/timer-2.0/contents/time.json';

  try {
    const response = await fetch(fileUrl, {
      method: 'GET',
      headers: {
        'Authorization': `token ${token}`
      }
    });

    if (!response.ok) {
      throw new Error(`GitHub API error: ${response.status}`);
    }

    const data = await response.json();
    console.log("✅ Token werkt! Inhoud van time.json:", atob(data.content));
    alert("✅ Token werkt! Zie console voor inhoud van time.json");

  } catch (error) {
    console.error("❌ Fout bij token-test:", error);
    alert("❌ Token werkt NIET of geen toegang tot file.");
  }
}

// Roep de test aan zodra de pagina laadt
testTokenWithCurlStyle();


// Roep de test aan zodra de pagina laadt
testTokenWithCurlStyle();

  </script>
</body>
</html>
